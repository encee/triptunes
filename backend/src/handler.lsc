import 'babel-polyfill'

import { isBlank, union } from 'lodash'

import getTrip from './getTrip'
import getPlacesFromTrip from './getPlacesFromTrip'
import getAllSongs from './getAllSongs'
import chooseBestSong from './chooseBestSong'
import makePlaylist from './makePlaylist'


module.exports.hello(event, context, callback) -/>
  { origin, destination } = event

  if origin~isBlank() or destination~isBlank() {
    callback('Specify origin and destionation via GET')
    return
  }

  tripCoordinates <- getTrip(origin, destination)

  tripPlaces <- getPlacesFromTrip(tripCoordinates)

  places = union([origin, destination], tripPlaces)

  chosenSongs <- places.map((place) -/> {
    songs <- getAllSongs(place)
    chooseBestSong(place, songs)
  })

  response = {
    statusCode: 200
    body: JSON.stringify({
      message: { tripCoordinates, places, chosenSongs }
      input: event
    })
  }

  callback(null, response)
